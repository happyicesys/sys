import{g as f,T as b,K as N,h as A,c as B,a as d,w as i,p as M,o as l,b as e,f as n,l as c,t as u,d as _,u as v,n as C,F as E,k as F,e as P}from"./app.8406c3b4.js";import{_ as x}from"./Button.2b3488f6.js";import{_ as y}from"./FormInput.4c46387f.js";import{_ as T}from"./Modal.d5ed722e.js";import{_ as w}from"./MultiSelect.1e501357.js";import{r as D}from"./PlusCircleIcon.ecc41778.js";import{r as R}from"./ArrowUturnLeftIcon.c9ad2330.js";import{r as L}from"./CheckCircleIcon.78ef6b9d.js";import{r as q}from"./BackspaceIcon.beb7fd41.js";import"./open-closed.050f8ae6.js";import"./disposables.3741dcda.js";import"./MultiSelect.vue_vue_type_style_index_1_lang.0a9af1cc.js";const z={class:"flex flex-col md:flex-row space-x-2"},K={key:0,class:"text-gray-600"},G={key:1},H={key:2,class:"text-gray-600"},I=["onSubmit"],J={class:"grid grid-cols-1 gap-y-3 gap-x-3 sm:grid-cols-6"},Q={class:"col-span-12 sm:col-span-6"},W={class:"col-span-12 sm:col-span-6"},X={class:"col-span-12 sm:col-span-6"},Y={class:"col-span-12 sm:col-span-6"},Z={key:0,class:"col-span-12 sm:col-span-6"},ee=e("label",{for:"text",class:"flex justify-start text-sm font-medium text-gray-700"}," Role ",-1),se={class:"col-span-12 sm:col-span-6"},te=e("label",{for:"text",class:"flex justify-start text-sm font-medium text-gray-700"}," Operator ",-1),oe={key:0,class:"text-sm text-red-600"},ae={key:1,class:"sm:col-span-6 pt-2 pb-1 md:pt-5 md:pb-3"},re=e("div",{class:"relative"},[e("div",{class:"absolute inset-0 flex items-center","aria-hidden":"true"},[e("div",{class:"w-full border-t border-gray-300"})]),e("div",{class:"relative flex justify-center"},[e("span",{class:"px-3 bg-white text-lg font-medium text-gray-900"}," Access Vending Machine(s) ")])],-1),le=[re],de={key:2,class:"sm:col-span-5"},ne=e("label",{for:"text",class:"flex justify-start text-sm font-medium text-gray-700"}," Vending Machine to Bind ",-1),ie={key:0,class:"text-sm text-red-600"},ce={key:3,class:"sm:col-span-1"},ue=e("span",null," Add ",-1),pe={key:4,class:"sm:col-span-6 flex flex-col mt-3"},me={class:"-my-2 -mx-4 overflow-x-auto sm:-mx-3 lg:-mx-5"},_e={class:"inline-block min-w-full py-2 align-middle md:px-4 lg:px-6"},ve={class:"overflow-hidden shadow ring-1 ring-black ring-opacity-5 md:rounded-lg"},fe={class:"min-w-full divide-y divide-gray-300"},xe=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{scope:"col",class:"px-3 py-3.5 text-center text-sm font-semibold text-gray-900"}," # "),e("th",{scope:"col",class:"px-3 py-3.5 text-center text-sm font-semibold text-gray-900"}," Vend ID "),e("th",{scope:"col",class:"px-3 py-3.5 text-center text-sm font-semibold text-gray-900"}," Name "),e("th",{scope:"col",class:"px-3 py-3.5 text-center text-sm font-semibold text-gray-900"}," Action ")])],-1),ye={class:"bg-white"},he={class:"whitespace-nowrap py-4 pl-4 pr-3 text-sm font-medium text-gray-900 sm:pl-6 text-center"},ge={class:"whitespace-nowrap py-4 pl-4 pr-3 text-sm font-semibold text-gray-900 sm:pl-6 text-center"},be={class:"whitespace-nowrap py-4 pl-4 pr-3 text-sm font-medium text-gray-900 sm:pl-6 text-center"},we={key:0},Ve=e("br",null,null,-1),ke={key:1},Oe={class:"whitespace-nowrap py-4 text-sm text-center"},Be={key:0},Ce=e("td",{colspan:"4",class:"whitespace-nowrap py-4 text-sm font-medium text-red-600 text-center"}," No Binding = Access to All ",-1),Se=[Ce],$e={class:"sm:col-span-6"},je={class:"flex space-x-1 mt-5 justify-end"},Ue=e("span",null," Back ",-1),Ne=e("span",null," Save ",-1),He={__name:"Form",props:{user:Object,countries:Object,operators:Object,permissions:[Array,Object],roles:Object,type:String,showModal:Boolean,unbindedVends:[Array,Object]},emits:["modalClose"],setup(p,{emit:V}){const r=p,s=f(b(g())),k=f([]),h=f([]),S=N().props.auth.operatorRole,m=f([]);A(()=>{s.value=r.user?b({...g(),...r.user}):b(g()),k.value=r.operators.data,h.value=r.roles.data,r.permissions.includes("admin-access operators")||(h.value=r.roles.data.filter(function(a){return a.name=="operator"||a.name=="operator_user"})),m.value=r.unbindedVends.data});function $(){r.user.vends.indexOf(s.value.vend_id)<0&&(r.user.vends.push(s.value.vend_id),r.user.vends.sort((a,o)=>a.code-o.code),m.value.splice(m.value.indexOf(s.value.vend_id),1),m.value.sort((a,o)=>a.code-o.code))}function j(a){r.user.vends.splice(r.user.vends.indexOf(a),1),m.value.push(a),m.value.sort((o,t)=>o.code-t.code)}function g(){return{name:"",email:"",username:"",password:"",operator_id:"",role_id:""}}function U(){s.value.clearErrors(),r.type==="create"&&s.value.transform(a=>({...a,operator_id:a.operator_id.id,role_id:a.role_id.id})).post("/users/create",{onSuccess:()=>{V("modalClose")},preserveState:!0,replace:!0}),r.type==="update"&&s.value.transform(a=>({...a,operator_id:a.operator_id.id,role_id:a.role_id.id,user:r.user})).post("/users/"+s.value.id+"/update",{onSuccess:()=>{V("modalClose")},preserveState:!0,replace:!0})}return(a,o)=>(l(),B(M,{to:"body"},[d(T,{open:p.showModal,onModalClose:o[9]||(o[9]=t=>a.$emit("modalClose"))},{header:i(()=>[e("div",z,[r.user?(l(),n("span",K," Editing ")):c("",!0),r.user?(l(),n("span",G,u(r.user.name),1)):(l(),n("span",H," Create New User "))])]),default:i(()=>[e("form",{onSubmit:P(U,["prevent"]),id:"submit"},[e("div",J,[e("div",Q,[d(y,{modelValue:s.value.name,"onUpdate:modelValue":o[0]||(o[0]=t=>s.value.name=t),error:s.value.errors.name,required:"true"},{default:i(()=>[_(" Name ")]),_:1},8,["modelValue","error"])]),e("div",W,[d(y,{modelValue:s.value.email,"onUpdate:modelValue":o[1]||(o[1]=t=>s.value.email=t),error:s.value.errors.email},{default:i(()=>[_(" Email ")]),_:1},8,["modelValue","error"])]),e("div",X,[d(y,{modelValue:s.value.username,"onUpdate:modelValue":o[2]||(o[2]=t=>s.value.username=t),error:s.value.errors.username},{default:i(()=>[_(" Username ")]),_:1},8,["modelValue","error"])]),e("div",Y,[d(y,{modelValue:s.value.password,"onUpdate:modelValue":o[3]||(o[3]=t=>s.value.password=t),error:s.value.errors.password,placeholderStr:[p.type=="update"?"Leave blank for same password":""],inputType:"password",autocomplete:"new-password"},{default:i(()=>[_(" Password "+u(p.type=="update"?"(Override)":""),1)]),_:1},8,["modelValue","error","placeholderStr"])]),v(S)?c("",!0):(l(),n("div",Z,[ee,d(w,{modelValue:s.value.role_id,"onUpdate:modelValue":o[4]||(o[4]=t=>s.value.role_id=t),options:h.value,trackBy:"id",valueProp:"id",label:"name",placeholder:"Select","open-direction":"bottom",class:"mt-1"},null,8,["modelValue","options"])])),e("div",se,[te,d(w,{modelValue:s.value.operator_id,"onUpdate:modelValue":o[5]||(o[5]=t=>s.value.operator_id=t),options:k.value,trackBy:"id",valueProp:"id",label:"name",placeholder:"Select","open-direction":"top",class:"mt-1"},null,8,["modelValue","options"]),s.value.errors.operator_id?(l(),n("div",oe,u(s.value.errors.operator_id),1)):c("",!0)]),s.value.id?(l(),n("div",ae,le)):c("",!0),s.value.id?(l(),n("div",de,[ne,d(w,{modelValue:s.value.vend_id,"onUpdate:modelValue":o[6]||(o[6]=t=>s.value.vend_id=t),options:m.value,trackBy:"id",valueProp:"id",label:"full_name",placeholder:"Select","open-direction":"bottom",class:"mt-1",ref:"multiselect"},null,8,["modelValue","options"]),s.value.errors.vend_id?(l(),n("div",ie,u(s.value.errors.vend_id),1)):c("",!0)])):c("",!0),s.value.id?(l(),n("div",ce,[d(x,{type:"button",onClick:o[7]||(o[7]=t=>$()),class:C(["bg-green-500 hover:bg-green-600 text-white flex space-x-1 sm:mt-6",[s.value.vend_id?"":"opacity-50 cursor-not-allowed"]]),disabled:!s.value.vend_id&&!p.permissions.includes("update operators")},{default:i(()=>[d(v(D),{class:"w-4 h-4"}),ue]),_:1},8,["class","disabled"])])):c("",!0),s.value.id?(l(),n("div",pe,[e("div",me,[e("div",_e,[e("div",ve,[e("table",fe,[xe,e("tbody",ye,[(l(!0),n(E,null,F(p.user.vends,(t,O)=>(l(),n("tr",{key:t.id,class:C(O%2===0?void 0:"bg-gray-50")},[e("td",he,u(O+1),1),e("td",ge,u(t.code),1),e("td",be,[t.latestVendBinding&&t.latestVendBinding.customer?(l(),n("span",we,[_(u(t.latestVendBinding.customer.code)+" ",1),Ve,_(" "+u(t.latestVendBinding.customer.name),1)])):(l(),n("span",ke,u(t.name),1))]),e("td",Oe,[p.permissions.includes("update operators")?(l(),B(x,{key:0,class:"bg-red-400 hover:bg-red-500 text-white",onClick:Ae=>j(t)},{default:i(()=>[d(v(q),{class:"w-4 h-4"})]),_:2},1032,["onClick"])):c("",!0)])],2))),128)),p.user.vends.length?c("",!0):(l(),n("tr",Be,Se))])])])])])])):c("",!0)]),e("div",$e,[e("div",je,[d(x,{class:"bg-gray-300 hover:bg-gray-400 text-gray-700 flex space-x-1",onClick:o[8]||(o[8]=t=>a.$emit("modalClose")),form:"submit"},{default:i(()=>[d(v(R),{class:"w-4 h-4"}),Ue]),_:1}),d(x,{type:"submit",class:"bg-green-500 hover:bg-green-600 text-white flex space-x-1"},{default:i(()=>[d(v(L),{class:"w-4 h-4"}),Ne]),_:1})])])],40,I)]),_:1},8,["open"])]))}};export{He as default};
