import{g,o as n,c as p,w as d,b as t,a as m,u as i,r as M,f,l as c,F as O,k as j,t as y,T as w,K as C,U,h as q,Z as E,d as v,e as F,m as H,v as I,n as K,i as Y}from"./app.57d21bbb.js";import{_ as P}from"./Authenticated.6a28e6ca.js";import{_ as $}from"./Button.c9bc234e.js";import{_ as D}from"./DatePicker.3e3575c6.js";import{_ as S}from"./FormInput.2fd5453b.js";import{_ as N}from"./MultiSelect.a777f435.js";import{H as T,$ as z,K as A,r as L,U as R,_ as Z,N as G}from"./MagnifyingGlassCircleIcon.275e1fe3.js";import{r as J}from"./ArrowUturnLeftIcon.e6a8a50f.js";import{r as Q}from"./ArrowUturnDownIcon.2c4604a2.js";import{r as W}from"./CheckCircleIcon.9bbb6e55.js";import"./open-closed.0369108b.js";import"./use-resolve-button-type.ef5fbc1d.js";import"./RectangleStackIcon.8c415ded.js";import"./main.c14e9e34.js";import"./MultiSelect.vue_vue_type_style_index_1_lang.1ce6b783.js";const X={class:"flex space-x-1"},ee={key:0,class:"text-red-500"},te={class:"relative mt-1"},se=["onClick"],oe={class:"block truncate"},ae={key:1,class:"text-sm text-red-600"},re={__name:"SearchVendCodeInput",props:{modelValue:[String,Number],required:[Boolean,String],error:String},emits:["update:modelValue","selected"],setup(s,{emit:r}){const h=g([]),e=_.debounce(async u=>{if(!u.target.value.length){h.value=[];return}axios({method:"get",url:"/api/vends/search/"+u.target.value}).then(b=>{h.value=b.data}).catch(b=>{console.log(b)})},300);function V(u){r("update:modelValue",u.target.value),e(u)}function x(u){r("selected",u)}return(u,b)=>(n(),p(i(G),{as:"div"},{default:d(()=>[t("div",X,[m(i(T),{class:"block text-sm font-medium text-gray-700"},{default:d(()=>[M(u.$slots,"default")]),_:3}),s.required?(n(),f("span",ee," * ")):c("",!0)]),t("div",te,[m(i(z),{class:"w-full rounded-md border border-gray-300 bg-white py-2 pl-3 pr-10 shadow-sm focus:border-indigo-500 focus:outline-none focus:ring-1 focus:ring-indigo-500 sm:text-sm",onInput:V,value:s.modelValue},null,8,["value"]),m(i(A),{class:"absolute inset-y-0 right-0 flex items-center rounded-r-md px-2 focus:outline-none"},{default:d(()=>[m(i(L),{class:"h-5 w-5 text-gray-400","aria-hidden":"true"})]),_:1}),h.value.length>0?(n(),p(i(R),{key:0,class:"absolute z-10 mt-1 max-h-60 w-full overflow-auto rounded-md bg-white py-1 text-base shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none sm:text-sm"},{default:d(()=>[(n(!0),f(O,null,j(h.value,k=>(n(),p(i(Z),{as:"template"},{default:d(()=>[t("li",{class:"relative cursor-default select-none py-2 pl-3 pr-9 hover:bg-gray-100",onClick:B=>x(k)},[t("span",oe,y(k.code),1)],8,se)]),_:2},1024))),256))]),_:1})):c("",!0),s.error?(n(),f("div",ae,y(s.error),1)):c("",!0)])]),_:3}))}},le={class:"font-semibold text-xl text-gray-800 leading-tight"},ne={key:0},de={key:1},ie=t("br",null,null,-1),ue={key:2},me=t("br",null,null,-1),ce={class:"m-2 sm:mx-5 sm:my-3 px-1 sm:px-2 lg:px-3"},ve={class:"mt-6 flex flex-col"},pe={class:"-my-2 -mx-4 sm:-mx-6 lg:-mx-8"},_e={class:"shadow-sm ring-1 ring-black ring-opacity-5 overflow-scroll p-5"},fe=["onSubmit"],ge={class:"grid grid-cols-1 gap-3 sm:grid-cols-6 pb-2"},ye={class:"sm:col-span-6"},he={class:"sm:col-span-6"},be={class:"relative flex items-start"},xe={class:"flex h-6 items-center"},Ve=["disabled"],ke=t("div",{class:"ml-3 text-sm leading-6"},[t("label",{for:"is_customer",class:"font-medium text-gray-900"},"Customer Binding?"),v(" "+y(" ")+" "),t("span",{id:"is_customer",class:"text-gray-500"},[t("span",{class:"sr-only"},"Customer Binding?"),v("retrieve customer data from cms")])],-1),we={key:0,class:"sm:col-span-6"},Ce=t("label",{for:"text",class:"flex justify-start text-sm font-medium text-gray-700"}," Customer ",-1),$e={key:1,class:"sm:col-span-6"},Se={class:"sm:col-span-6"},Be=t("label",{for:"text",class:"flex justify-start text-sm font-medium text-gray-700"}," Operator ",-1),Ue={class:"sm:col-span-3"},De={class:"sm:col-span-3"},Ne={class:"sm:col-span-6"},Oe={class:"sm:col-span-6"},Me={class:"flex space-x-1 mt-5 justify-end"},je=t("span",null," Back ",-1),qe=t("span",null," Unbind ",-1),Ee=t("span",null," Save ",-1),We={__name:"Edit",props:{adminCustomerOptions:Object,operatorOptions:Object,vend:Object,type:String},setup(s){const r=s,h=g([]);g([]);const e=g(w(b()));g(!1);const V=g([]),x=g("");C().props.auth.operatorCountry,C().props.auth.operatorRole;const u=C().props.auth.permissions;g(U().format("HH:mm:ss")),q(()=>{r.type=="create"?x.value="Create New":x.value="Edit",h.value=r.adminCustomerOptions.map(o=>({id:o.id,full_name:o.cust_id+" - "+o.company})),V.value=[...r.operatorOptions.data.map(o=>({id:o.id,full_name:o.full_name}))],e.value=r.vend&&r.vend.id?w(r.vend):w(b()),e.value.name=r.vend.name,r.vend.customer_id&&(e.value.is_customer=!0,e.value.customer_id={id:r.vend.person_id,full_name:r.vend.customer_code+" - "+r.vend.customer_name}),r.vend.operator_id&&(e.value.operator_id={id:r.vend.operator_id,full_name:r.vend.operator_name})});function b(){return{code:"",name:"",begin_date:U().format("YYYY-MM-DD"),customer_id:"",operator_id:"",serial_num:"",termination_date:"",private_key:""}}function k(o){e.value.code=o.code}function B(){e.value.clearErrors(),r.type==="create"&&e.value.transform(o=>({...o,customer_id:o.customer_id?o.customer_id.id:null,operator_id:o.operator_id?o.operator_id.id:null})).post("/vends/create",{preserveState:!0,replace:!0}),r.type==="update"&&e.value.transform(o=>({...o,customer_id:o.customer_id?o.customer_id.id:null,operator_id:o.operator_id?o.operator_id.id:null})).post("/vends/"+e.value.id+"/update",{preserveState:!0,replace:!0})}return(o,a)=>(n(),f(O,null,[m(i(E),{title:"VM Management"}),m(P,null,{header:d(()=>[t("h2",le,[v(y(x.value)+" Vending Machine ",1),s.type=="update"?(n(),f("span",ne,y(s.vend.code),1)):c("",!0),s.vend.customer_name?(n(),f("span",de,[ie,v(" "+y(s.vend.customer_code)+" - "+y(s.vend.customer_name),1)])):!s.vend.customer_name&&s.vend.name?(n(),f("span",ue,[me,v(" "+y(s.vend.name),1)])):c("",!0)])]),default:d(()=>[t("div",ce,[t("div",ve,[t("div",pe,[t("div",_e,[t("form",{onSubmit:F(B,["prevent"]),id:"submit"},[t("div",ge,[t("div",ye,[s.type=="update"?(n(),p(S,{key:0,modelValue:e.value.code,"onUpdate:modelValue":a[0]||(a[0]=l=>e.value.code=l),error:e.value.errors.code,required:"true",disabled:s.vend.code},{default:d(()=>[v(" Code ")]),_:1},8,["modelValue","error","disabled"])):c("",!0),s.type=="create"?(n(),p(re,{key:1,modelValue:e.value.code,"onUpdate:modelValue":a[1]||(a[1]=l=>e.value.code=l),onSelected:k,required:"true",error:e.value.errors.code},{default:d(()=>[v(" Code ")]),_:1},8,["modelValue","error"])):c("",!0)]),t("div",he,[t("div",be,[t("div",xe,[H(t("input",{"aria-describedby":"is_customer","onUpdate:modelValue":a[2]||(a[2]=l=>e.value.is_customer=l),disabled:s.vend.customer_id&&s.type=="update",name:"is_customer",type:"checkbox",class:K(["h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-600",[s.vend.customer_id&&s.type=="update"?"bg-gray-200 hover:cursor-not-allowed":""]])},null,10,Ve),[[I,e.value.is_customer]])]),ke])]),e.value.is_customer?(n(),f("div",we,[Ce,m(N,{modelValue:e.value.customer_id,"onUpdate:modelValue":a[3]||(a[3]=l=>e.value.customer_id=l),options:h.value,trackBy:"id",valueProp:"id",label:"full_name",placeholder:"Select","open-direction":"bottom",class:"mt-1"},null,8,["modelValue","options"])])):c("",!0),e.value.is_customer?c("",!0):(n(),f("div",$e,[m(S,{modelValue:e.value.name,"onUpdate:modelValue":a[4]||(a[4]=l=>e.value.name=l),error:e.value.errors.name},{default:d(()=>[v(" Name ")]),_:1},8,["modelValue","error"])])),t("div",Se,[Be,m(N,{modelValue:e.value.operator_id,"onUpdate:modelValue":a[5]||(a[5]=l=>e.value.operator_id=l),options:V.value,trackBy:"id",valueProp:"id",label:"full_name",placeholder:"Select","open-direction":"bottom",class:"mt-1"},null,8,["modelValue","options"])]),t("div",Ue,[i(u).includes("update vends")?(n(),p(D,{key:0,modelValue:e.value.begin_date,"onUpdate:modelValue":a[6]||(a[6]=l=>e.value.begin_date=l),error:e.value.errors.begin_date,onInput:a[7]||(a[7]=l=>o.onDateFromChanged())},{default:d(()=>[v(" Begin Date ")]),_:1},8,["modelValue","error"])):c("",!0)]),t("div",De,[i(u).includes("update vends")?(n(),p(D,{key:0,modelValue:e.value.termination_date,"onUpdate:modelValue":a[8]||(a[8]=l=>e.value.termination_date=l),error:e.value.errors.termination_date,minDate:e.value.begin_date},{default:d(()=>[v(" Termination Date ")]),_:1},8,["modelValue","error","minDate"])):c("",!0)]),t("div",Ne,[m(S,{modelValue:e.value.private_key,"onUpdate:modelValue":a[9]||(a[9]=l=>e.value.private_key=l),error:e.value.errors.private_key,disabled:!i(u).includes("update vends")},{default:d(()=>[v(" Private Key ")]),_:1},8,["modelValue","error","disabled"])])]),t("div",Oe,[t("div",Me,[m(i(Y),{href:"/settings"},{default:d(()=>[m($,{class:"bg-gray-300 hover:bg-gray-400 text-gray-700 flex space-x-1"},{default:d(()=>[m(i(J),{class:"w-4 h-4"}),je]),_:1})]),_:1}),s.vend.latestVendBinding&&s.vend.latestVendBinding.customer&&i(u).includes("update vends")?(n(),p($,{key:0,type:"button",class:"bg-yellow-500 hover:bg-yellow-600 text-white flex space-x-1",onClick:a[10]||(a[10]=l=>o.unbindCustomer(e.value.id))},{default:d(()=>[m(i(Q),{class:"w-4 h-4"}),qe]),_:1})):c("",!0),i(u).includes("update vends")?(n(),p($,{key:1,type:"submit",class:"bg-green-500 hover:bg-green-600 text-white flex space-x-1"},{default:d(()=>[m(i(W),{class:"w-4 h-4"}),Ee]),_:1})):c("",!0)])])],40,fe)])])])])]),_:1})],64))}};export{We as default};
