import{g as v,T as O,h as G,j as C,f as r,a as s,u as f,w as i,F as w,o as n,Z as J,b as t,d as m,t as p,l as d,e as P,i as K,n as B,k as q,O as U}from"./app.b6d96ed6.js";import{_ as W}from"./Authenticated.3c41ac9c.js";import{_ as x}from"./Button.88486701.js";import{_ as F}from"./DatetimePicker.8b3a9442.js";import{_ as c}from"./FormInput.85b46190.js";import{_ as h}from"./MultiSelect.2b3a4877.js";import{_ as b,a as V}from"./TableData.95fd8ac9.js";import{r as X}from"./ArrowUturnLeftIcon.c34d8c5c.js";import{r as M}from"./CheckCircleIcon.3ff518f6.js";import{r as ee}from"./XCircleIcon.1d043962.js";import"./keyboard.1cce9ba1.js";import"./use-resolve-button-type.f670a6e1.js";import"./RectangleStackIcon.b3a46605.js";import"./main.c17a4508.js";import"./MultiSelect.vue_vue_type_style_index_1_lang.fe1aecf3.js";const te={class:"font-semibold text-xl text-gray-800 leading-tight"},ae={key:0},le={class:"m-2 sm:mx-5 sm:my-3 px-1 sm:px-2 lg:px-3"},oe={class:"mt-6 flex flex-col"},se={class:"-my-2 -mx-4 sm:-mx-6 lg:-mx-8"},re={class:"shadow-sm ring-1 ring-black ring-opacity-5 p-5 mb-3"},ie={class:"grid grid-cols-1 gap-3 sm:grid-cols-6 pb-5 mb-3"},ne={class:"sm:col-span-6"},me={class:"sm:col-span-6"},de=t("label",{for:"text",class:"flex justify-start text-sm font-medium text-gray-700"}," Delivery Product Mapping ",-1),ue={class:"mt-1"},pe=["value"],_e={class:"sm:col-span-6"},ce=t("label",{for:"text",class:"flex justify-start text-sm font-medium text-gray-700"}," Delivery Platform ",-1),ve={class:"mt-1"},fe=["value"],ge={class:"sm:col-span-3"},ye=t("span",{class:"text-red-500"}," * ",-1),xe={class:"sm:col-span-3"},he=t("span",{class:"text-red-500"}," * ",-1),be={class:"sm:col-span-6"},Ve={class:"flex space-x-1 mt-5 justify-end"},ke=t("span",null," Back ",-1),Ce=t("span",null," Save ",-1),we=t("span",null," Sync to VM & Submit to Platform ",-1),Pe=t("div",{class:"sm:col-span-6 pt-2 pb-1 md:pt-5 md:pb-3"},[t("div",{class:"relative"},[t("div",{class:"absolute inset-0 flex items-center","aria-hidden":"true"},[t("div",{class:"w-full border-t border-gray-300"})]),t("div",{class:"relative flex justify-center"},[t("span",{class:"px-3 bg-white text-lg font-medium text-gray-900 rounded"},"Campaign Item(s)")])])],-1),Se={key:0,class:"sm:col-span-6"},je={class:"inline-flex justify-center items-center rounded px-3 py-1 my-1 text-lg font-medium border min-w-fit bg-red-300 text-gray-800"},De={class:"flex flex-col"},Oe={key:1,class:"sm:col-span-6"},qe=t("label",{for:"text",class:"flex justify-start text-sm font-medium text-gray-700"},[m(" Type "),t("span",{class:"text-red-500"}," * ")],-1),Ue={key:2,class:"sm:col-span-2"},Me={key:3,class:"sm:col-span-2"},Ie={key:4,class:"sm:col-span-2"},Ne={key:5,class:"sm:col-span-2"},$e={key:6,class:"sm:col-span-2"},Le={key:7,class:"sm:col-span-5"},Be=t("label",{for:"text",class:"flex justify-start text-sm font-medium text-gray-700"},[m(" Scope "),t("span",{class:"text-red-500"}," * ")],-1),Fe={key:8,class:"sm:col-span-3"},Ye=t("label",{for:"text",class:"flex justify-start text-sm font-medium text-gray-700"},[m(" User "),t("span",{class:"text-red-500"}," * ")],-1),Te={key:9,class:"sm:col-span-2"},Ae={key:10,class:"sm:col-span-6"},Ee=t("label",{for:"text",class:"flex justify-start text-sm font-medium text-gray-700"},[m(" Product "),t("span",{class:"text-red-500"}," * ")],-1),He={key:0,class:"text-red-500 text-sm"},Re={key:11,class:"sm:col-span-6"},ze=t("label",{for:"text",class:"flex justify-start text-sm font-medium text-gray-700"},[m(" Category "),t("span",{class:"text-red-500"}," * ")],-1),Qe={key:12,class:"sm:col-span-6"},Ze={key:13,class:"sm:col-span-6"},Ge=t("span",null," Create Campaign Item ",-1),Je=t("span",{class:"sm:col-span-6"},null,-1),Ke={key:14,class:"sm:col-span-6 flex flex-col mt-2 mx-2 mb-3"},We={class:"mt-6 flex flex-col"},Xe={class:"-my-2 -mx-4 sm:-mx-6 lg:-mx-8 px-3"},et={class:"shadow-sm ring-1 ring-black ring-opacity-5 overflow-scroll"},tt={class:"min-w-full border-separate",style:{"border-spacing":"0"}},at={class:"bg-gray-100"},lt={class:"divide-x divide-gray-200"},ot=t("br",null,null,-1),st={class:"bg-white"},rt=t("br",null,null,-1),it={class:"text-blue-700"},nt={key:0,role:"list",class:"divide-y divide-gray-100 overflow-scroll bg-white"},mt={class:"flex justify-between gap-x-1 px-1 py-0.5"},dt={class:"flex min-w-0 gap-x-4"},ut={class:"text-sm"},pt={class:"min-w-0 flex-auto"},_t={class:"text-sm font-semibold leading-2 text-gray-900"},ct={key:0,role:"list",class:"divide-y divide-gray-100 overflow-scroll bg-white"},vt={class:"flex justify-between gap-x-2 px-1 py-0.5"},ft={class:"flex min-w-0 gap-x-3"},gt={class:"min-w-0 flex-auto pt-1"},yt={class:"text-sm font-semibold leading-2 text-gray-900"},xt={key:0,class:"text-xs"},ht={key:0},bt=t("td",{colspan:"24",class:"relative whitespace-nowrap py-4 pr-4 pl-3 text-sm font-medium sm:pr-6 lg:pr-8 text-center"}," No Results Found ",-1),Vt=[bt],Bt={__name:"Edit",props:{deliveryPlatformCampaign:Object,deliveryPlatformCampaignItemOptions:Object,type:String},setup(S){const _=S,I=v([]),u=v([]),N=v([]),e=v(O($())),k=v(!1);v(!1);const j=v("");function $(){return{id:"",cap:"",datetime_from:"",datetime_to:"",delivery_platform_campaign_item:"",delivery_platform_campaign_item_scope:"",delivery_product_mapping_items:"",min_basket_amount:0,qty:"",total_count:"",total_count_per_user:"",promo_value:""}}G(()=>{_.type=="create"?j.value="Create New":j.value="Edit",u.value=_.deliveryPlatformCampaign.data,N.value=_.deliveryPlatformCampaign.data.deliveryProductMapping.deliveryProductMappingItems.map(o=>({id:o.id,full_name:"(#"+o.channel_code+") "+o.product.code+" "+o.product.name,img_url:o.product.thumbnail?o.product.thumbnail.full_url:"",product_id:o.product.id})),I.value=[_.deliveryPlatformCampaign.data.deliveryProductMapping.category_json?{id:_.deliveryPlatformCampaign.data.deliveryProductMapping.category_json.id,name:_.deliveryPlatformCampaign.data.deliveryProductMapping.category_json.name}:{id:"",name:""}],e.value=u.value?O(u.value):O($())});const Y=C(function(){return moment().add(30,"minutes").format("YYYY-MM-DD HH:mm:ss")}),D=C(function(){let o="";return e.value.delivery_platform_campaign_item&&e.value.promo_value&&(e.value.delivery_platform_campaign_item.phrase1&&(o+=e.value.delivery_platform_campaign_item.phrase1),e.value.delivery_platform_campaign_item.qty?o+=e.value.qty?e.value.qty:"":o+=e.value.promo_value?e.value.promo_value:"",e.value.delivery_platform_campaign_item.phrase2&&(o+=e.value.delivery_platform_campaign_item.phrase2),e.value.delivery_platform_campaign_item.cap&&(o+=e.value.cap?e.value.cap:""),e.value.delivery_platform_campaign_item.qty?o+=e.value.promo_value?e.value.promo_value:"":o+=e.value.qty?e.value.qty:"",e.value.delivery_platform_campaign_item.phrase3&&(o+=" "+e.value.delivery_platform_campaign_item.phrase3),e.value.delivery_platform_campaign_item_scope&&(o+=" "+e.value.delivery_platform_campaign_item_scope.name)),o}),T=C(function(){return moment(e.value.datetime_from).add(2,"hours").format("YYYY-MM-DD HH:mm:ss")}),L=C(function(){let o=!0;return(!e.value.delivery_platform_campaign_item||!e.value.promo_value||!e.value.delivery_platform_campaign_item_scope)&&(o=!1),e.value.delivery_platform_campaign_item&&e.value.delivery_platform_campaign_item.qty&&!e.value.qty&&(o=!1),e.value.delivery_platform_campaign_item_scope_eater_type||(o=!1),e.value.delivery_platform_campaign_item_scope&&e.value.delivery_platform_campaign_item_scope.isProduct&&(e.value.delivery_product_mapping_items?(e.value.delivery_product_mapping_items.length==0&&(o=!1),e.value.delivery_platform_campaign_item_scope.singleObjectOnly&&e.value.delivery_product_mapping_items.length>1&&(o=!1)):o=!1),e.value.delivery_platform_campaign_item_scope&&e.value.delivery_platform_campaign_item_scope.isCategory&&e.value.category&&e.value.category.length==0&&(e.value.category?(e.value.category.length==0&&(o=!1),e.value.category.singleObjectOnly&&e.value.category.length>1&&(o=!1)):o=!1),o});function A(){k.value=!0,e.value.delivery_platform_campaign_item_scope="",e.value.delivery_platform_campaign_item_scope_eater_type="",e.value.category="",e.value.qty="",e.value.promo_value="",e.value.cap="",e.value.total_count="",e.value.total_count_per_user=""}function E(){k.value=!0}function H(o){!confirm("Are you sure to delete this entry?")||U.delete("/delivery-platform-campaigns/item/"+o,{preserveState:!1,preserveScroll:!0,replace:!0})}function R(){U.post("/delivery-platform-campaigns/"+e.value.id+"/create-item",{...e.value,delivery_platform_campaign_item:e.value.delivery_platform_campaign_item?e.value.delivery_platform_campaign_item.id:"",delivery_platform_campaign_item_scope:e.value.delivery_platform_campaign_item_scope?e.value.delivery_platform_campaign_item_scope.id:"",delivery_platform_campaign_item_scope_eater_type:e.value.delivery_platform_campaign_item_scope_eater_type?e.value.delivery_platform_campaign_item_scope_eater_type.id:"",settings_label:D.value},{preserveState:!1,preserveScroll:!0,replace:!0})}function z(){e.value.clearErrors(),e.value.transform(o=>({name:o.name,reserved_percent:o.reserved_percent,reserved_qty:o.reserved_qty})).post("/delivery-product-mappings/"+e.value.id+"/update",{preserveState:!0,replace:!0})}function Q(o){!confirm("Are you sure to submit this campaign and its items to platform?")||U.post("/delivery-platform-campaigns/"+o+"/submit-platform",{},{preserveState:!1,preserveScroll:!0,replace:!0})}return(o,l)=>(n(),r(w,null,[s(f(J),{title:"Delivery Product Mapping"}),s(W,null,{header:i(()=>[t("h2",te,[m(p(j.value)+" Delivery Platform Campaign ",1),S.type=="update"?(n(),r("span",ae,p(u.value.name),1)):d("",!0)])]),default:i(()=>[t("div",le,[t("div",oe,[t("div",se,[t("div",re,[t("form",{onSubmit:P(z,["prevent"]),id:"submit"},[t("div",ie,[t("div",ne,[s(c,{modelValue:e.value.name,"onUpdate:modelValue":l[0]||(l[0]=a=>e.value.name=a),error:e.value.errors.name,required:"true"},{default:i(()=>[m(" Name ")]),_:1},8,["modelValue","error"])]),t("div",me,[de,t("div",ue,[t("input",{type:"text",class:"shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full text-sm border-gray-300 rounded-md bg-gray-200 hover:cursor-not-allowed",value:_.deliveryPlatformCampaign.data.deliveryProductMapping.name,disabled:""},null,8,pe)])]),t("div",_e,[ce,t("div",ve,[t("input",{type:"text",class:"shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full text-sm border-gray-300 rounded-md bg-gray-200 hover:cursor-not-allowed",value:_.deliveryPlatformCampaign.data.deliveryPlatformOperator.deliveryPlatform.name+" ("+_.deliveryPlatformCampaign.data.deliveryPlatformOperator.type+")",disabled:""},null,8,fe)])]),t("div",ge,[s(F,{modelValue:e.value.datetime_from,"onUpdate:modelValue":l[1]||(l[1]=a=>e.value.datetime_from=a),error:e.value.errors.datetime_from,minDate:Y.value,onInput:l[2]||(l[2]=a=>o.onDateFromChanged())},{default:i(()=>[m(" Begin Date "),ye]),_:1},8,["modelValue","error","minDate"])]),t("div",xe,[s(F,{modelValue:e.value.datetime_to,"onUpdate:modelValue":l[3]||(l[3]=a=>e.value.datetime_to=a),error:e.value.errors.datetime_to,minDate:T.value},{default:i(()=>[m(" End Date "),he]),_:1},8,["modelValue","error","minDate"])]),t("div",be,[t("div",Ve,[s(f(K),{href:"/delivery-platform-campaigns"},{default:i(()=>[s(x,{class:"bg-gray-300 hover:bg-gray-400 text-gray-700 flex space-x-1"},{default:i(()=>[s(f(X),{class:"w-4 h-4"}),ke]),_:1})]),_:1}),s(x,{type:"submit",class:"bg-green-500 hover:bg-green-600 text-white flex space-x-1"},{default:i(()=>[s(f(M),{class:"w-4 h-4"}),Ce]),_:1}),s(x,{class:"bg-yellow-500 hover:bg-yellow-600 text-black flex space-x-1",onClick:l[4]||(l[4]=P(a=>Q(u.value.id),["prevent"]))},{default:i(()=>[s(f(M),{class:"w-4 h-4"}),we]),_:1})])]),Pe,D.value?(n(),r("div",Se,[t("div",je,[t("div",De,p(D.value),1)])])):d("",!0),e.value.id?(n(),r("div",Oe,[qe,s(h,{modelValue:e.value.delivery_platform_campaign_item,"onUpdate:modelValue":l[5]||(l[5]=a=>e.value.delivery_platform_campaign_item=a),options:S.deliveryPlatformCampaignItemOptions,trackBy:"id",valueProp:"id",label:"name",placeholder:"Select","open-direction":"top",class:"mt-1",onSelected:l[6]||(l[6]=a=>A())},null,8,["modelValue","options"])])):d("",!0),e.value.delivery_platform_campaign_item&&e.value.delivery_platform_campaign_item.cap?(n(),r("div",Ue,[s(c,{modelValue:e.value.cap,"onUpdate:modelValue":l[7]||(l[7]=a=>e.value.cap=a),error:e.value.errors.cap,placeholderStr:"Number"},{default:i(()=>[m(" Cap (Max Discount Dollar) ")]),_:1},8,["modelValue","error"])])):d("",!0),e.value.delivery_platform_campaign_item&&e.value.delivery_platform_campaign_item.qty?(n(),r("div",Me,[s(c,{modelValue:e.value.qty,"onUpdate:modelValue":l[8]||(l[8]=a=>e.value.qty=a),error:e.value.errors.qty,placeholderStr:"Number",required:"true"},{default:i(()=>[m(" Bundle Total Qty ")]),_:1},8,["modelValue","error"])])):d("",!0),e.value.delivery_platform_campaign_item&&e.value.delivery_platform_campaign_item.id?(n(),r("div",Ie,[s(c,{modelValue:e.value.promo_value,"onUpdate:modelValue":l[9]||(l[9]=a=>e.value.promo_value=a),error:e.value.errors.promo_value,placeholderStr:"Number",required:"true"},{default:i(()=>[m(" Value ("+p(e.value.delivery_platform_campaign_item.id)+") ",1)]),_:1},8,["modelValue","error"])])):d("",!0),e.value.delivery_platform_campaign_item?(n(),r("div",Ne,[s(c,{modelValue:e.value.total_count,"onUpdate:modelValue":l[10]||(l[10]=a=>e.value.total_count=a),error:e.value.errors.total_count,placeholderStr:"Default Unlimited"},{default:i(()=>[m(" Redemption Limit ")]),_:1},8,["modelValue","error"])])):d("",!0),e.value.delivery_platform_campaign_item?(n(),r("div",$e,[s(c,{modelValue:e.value.total_count_per_user,"onUpdate:modelValue":l[11]||(l[11]=a=>e.value.total_count_per_user=a),error:e.value.errors.total_count_per_user,placeholderStr:"Default Unlimited"},{default:i(()=>[m(" Redemtion Limit/ User ")]),_:1},8,["modelValue","error"])])):d("",!0),e.value.delivery_platform_campaign_item?(n(),r("div",Le,[Be,s(h,{modelValue:e.value.delivery_platform_campaign_item_scope,"onUpdate:modelValue":l[12]||(l[12]=a=>e.value.delivery_platform_campaign_item_scope=a),options:e.value.delivery_platform_campaign_item.scope,trackBy:"id",valueProp:"id",label:"name",placeholder:"Select","open-direction":"top",class:"mt-1",onSelected:l[13]||(l[13]=a=>E())},null,8,["modelValue","options"])])):d("",!0),e.value.delivery_platform_campaign_item_scope?(n(),r("div",Fe,[Ye,s(h,{modelValue:e.value.delivery_platform_campaign_item_scope_eater_type,"onUpdate:modelValue":l[14]||(l[14]=a=>e.value.delivery_platform_campaign_item_scope_eater_type=a),options:e.value.delivery_platform_campaign_item_scope.eaterType,trackBy:"id",valueProp:"id",label:"name",placeholder:"Select","open-direction":"top",class:"mt-1"},null,8,["modelValue","options"])])):d("",!0),e.value.delivery_platform_campaign_item_scope&&e.value.delivery_platform_campaign_item_scope.minBasketAmount?(n(),r("div",Te,[s(c,{modelValue:e.value.min_basket_amount,"onUpdate:modelValue":l[15]||(l[15]=a=>e.value.min_basket_amount=a),error:e.value.errors.min_basket_amount,placeholderStr:"Number"},{default:i(()=>[m(" Minimum Basket Amount ")]),_:1},8,["modelValue","error"])])):d("",!0),e.value.delivery_platform_campaign_item_scope&&e.value.delivery_platform_campaign_item_scope.isProduct?(n(),r("span",Ae,[Ee,s(h,{modelValue:e.value.delivery_product_mapping_items,"onUpdate:modelValue":l[16]||(l[16]=a=>e.value.delivery_product_mapping_items=a),options:N.value,trackBy:"id",valueProp:"id",label:"full_name",mode:"tags",placeholder:"Select","open-direction":"bottom",class:"mt-1",clear:k.value,max:e.value.delivery_platform_campaign_item_scope.singleObjectOnly?1:-1},null,8,["modelValue","options","clear","max"]),t("span",null,[e.value.delivery_platform_campaign_item_scope.singleObjectOnly?(n(),r("span",He," * Single Object Only ")):d("",!0)])])):d("",!0),e.value.delivery_platform_campaign_item_scope&&e.value.delivery_platform_campaign_item_scope.isCategory?(n(),r("span",Re,[ze,s(h,{modelValue:e.value.category,"onUpdate:modelValue":l[17]||(l[17]=a=>e.value.category=a),options:I.value,trackBy:"id",valueProp:"id",label:"name",placeholder:"Select","open-direction":"bottom",class:"mt-1",clear:k.value,max:e.value.delivery_platform_campaign_item_scope.singleObjectOnly?1:-1},null,8,["modelValue","options","clear","max"])])):d("",!0),e.value.delivery_platform_campaign_item&&e.value.delivery_platform_campaign_item_scope?(n(),r("div",Qe,[s(c,{modelValue:e.value.settings_name,"onUpdate:modelValue":l[18]||(l[18]=a=>e.value.settings_name=a),error:e.value.errors.settings_name,placeholderStr:"Campaign Item Name"},{default:i(()=>[m(" Campaign Item Name (Optional) ")]),_:1},8,["modelValue","error"])])):d("",!0),e.value.id?(n(),r("div",Ze,[s(x,{type:"button",onClick:l[19]||(l[19]=P(a=>R(),["prevent"])),class:B(["bg-green-500 hover:bg-green-600 text-white flex space-x-1 sm:mt-1",[L.value?"":"opacity-50 cursor-not-allowed"]]),disabled:!L.value},{default:i(()=>[s(f(M),{class:"w-4 h-4"}),Ge]),_:1},8,["class","disabled"])])):d("",!0),Je,e.value.id?(n(),r("div",Ke,[t("div",We,[t("div",Xe,[t("div",et,[t("table",tt,[t("thead",at,[t("tr",lt,[s(b,null,{default:i(()=>[m(" # ")]),_:1}),s(b,null,{default:i(()=>[m(" Name "),ot,m(" Label ")]),_:1}),s(b,null,{default:i(()=>[m(" Settings ")]),_:1}),s(b,null,{default:i(()=>[m(" Items ")]),_:1}),s(b,null,{default:i(()=>[m(" Action ")]),_:1})])]),t("tbody",st,[(n(!0),r(w,null,q(u.value.deliveryPlatformCampaignItems,(a,g)=>(n(),r("tr",{key:a.id,class:"divide-x divide-gray-300"},[s(V,{currentIndex:g,totalLength:u.value.deliveryPlatformCampaignItems.length,inputClass:"text-center"},{default:i(()=>[m(p(g+1),1)]),_:2},1032,["currentIndex","totalLength"]),s(V,{currentIndex:g,totalLength:u.value.deliveryPlatformCampaignItems.length,inputClass:"text-center"},{default:i(()=>[m(p(a.settings_name)+" ",1),rt,t("span",it,p(a.settings_label),1)]),_:2},1032,["currentIndex","totalLength"]),s(V,{currentIndex:g,totalLength:u.value.deliveryPlatformCampaignItems.length,inputClass:"text-center"},{default:i(()=>[a.settings_json?(n(),r("ul",nt,[(n(!0),r(w,null,q(a.settings_json,(y,Z)=>(n(),r("li",mt,[t("div",dt,[t("span",ut,p(Z)+": ",1),t("div",pt,[t("p",_t,p(y),1)])])]))),256))])):d("",!0)]),_:2},1032,["currentIndex","totalLength"]),s(V,{currentIndex:g,totalLength:u.value.deliveryPlatformCampaignItems.length,inputClass:"text-left"},{default:i(()=>[a.items_json?(n(),r("ul",ct,[(n(!0),r(w,null,q(a.items_json,y=>(n(),r("li",vt,[t("div",ft,[t("div",gt,[t("p",yt,p(y.full_name?y.full_name:y.name),1)])])]))),256))])):d("",!0)]),_:2},1032,["currentIndex","totalLength"]),s(V,{currentIndex:g,totalLength:u.value.deliveryPlatformCampaignItems.length,inputClass:"text-center"},{default:i(()=>[s(x,{onClick:P(y=>H(a.id),["prevent"]),class:B(["flex flex-col bg-red-500 hover:bg-red-600 text-white",[a.deliveryPlatformCampaignItemVends&&a.deliveryPlatformCampaignItemVends.length>0?"opacity-50 cursor-not-allowed":""]]),disabled:a.deliveryPlatformCampaignItemVends&&a.deliveryPlatformCampaignItemVends.length>0},{default:i(()=>[s(f(ee),{class:"w-4 h-4"}),a.deliveryPlatformCampaignItemVends&&a.deliveryPlatformCampaignItemVends.length>0?(n(),r("span",xt," Campaigns running, cannot delete ")):d("",!0)]),_:2},1032,["onClick","disabled","class"])]),_:2},1032,["currentIndex","totalLength"])]))),128)),u.value.deliveryPlatformCampaignItems.length?d("",!0):(n(),r("tr",ht,Vt))])])])])])])):d("",!0)])],32)])])])])]),_:1})],64))}};export{Bt as default};
